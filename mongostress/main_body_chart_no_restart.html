<style>
	a:link, a:visited, a:hover, a:active {
		text-decoration:none	;
		font-weight: normal
	}
</style>

<br>
<div id='navi'  style='display:block; 
	min-width: 200px; height: 600px; 
	margin: 100 auto; 
	background-color:#def; 
	overflow:hidden;
	float:left;
	line-height: 240%
'>
	<a href='#'  onclick='javascript:cmdStart();return false;' accesskey='s' ><u>S</u>tart Load</a><br>
	<a href='#'  onclick='javascript:cmdStop() ;return false;' accesskey='p' >sto<u>p</u> Server App Loading</a><br>
	<a href='#'  onclick='javascript:cmChartingStop() ;return false;' accesskey='c' >stop <u>C</u>harting</u></a><br>
</div>

<div id='navi'  style='display:block; 
	min-width: 100px; height: 600px; 
	margin: 100 auto; 
	background-color:#cdf; 
	overflow:hidden;
	float:left;
	line-height: 240%
'>
	<script>
		function changeThreadNumber(explicitThis, argIncDec, readOrLoad){
			
			
			var inputId = "#inpChange"+readOrLoad+"Threads"
			var ajaxUrl = '/change'+readOrLoad+'Threads/'

			var prevVal = $(inputId).val();
			
			prevVal = parseInt(prevVal) + argIncDec;

			$.ajax({
					url:   ajaxUrl + prevVal,
					cache: false,
					timeout: 2000
				}
			)
			.always(   function( data, textStatus, errorThrown) { 
					//alert('complete ' + textStatus);	
					if( textStatus == "timeout"	){
						alert('timed out');	
					}
				}			
			)
			.fail(    function() {
					$('#msg-area').prepend( '<br>failed /change'+readOrLoad+'Threads/'+ prevVal + '<br>' );
					//alert('fail');
				}
			)
			.done(    function( respText ) {
					$('#msg-area').prepend( '<br>' + respText + ' (' +argIncDec +')<br>' );
					$(inputId).val(prevVal);
					//alert('done');
				}
			);
			
			
			
		}
	</script>

	Load Threads<br>
	<form id='frmChangeLoadThreads'>
		<a href='#'  onclick='javascript:changeThreadNumber(this,-1,"Load");return false;' accesskey='i' ><</a>
		<input 
			type='text' 
			id='inpChangeLoadThreads'
			name='inpChangeLoadThreads'
			value='2'
			min=0 max=12 maxlength=2 
			pattern="[0-9]+"
			size=2  style='width:20px' autofocus='autofocus' 
			placeholder='Anzahl insert Threads'
		/>
	<a href='#'  onclick='javascript:changeThreadNumber(this,1,"Load");return false;' accesskey='j' >></a><br>
	</form>

	<br>Read Threads<br>
	<form id='frmChangeReadThreads'>
		<a href='#'  onclick='javascript:changeThreadNumber(this,-1,"Read");return false;' accesskey='r' ><</a>
		<input 
			type='text' 
			id='inpChangeReadThreads'
			name='inpChangeReadThreads'
			value='2'
			min=0 max=12 maxlength=2 
			pattern="[0-9]+"
			size=2  style='width:20px' autofocus='autofocus' 
			placeholder='Anzahl insert Threads'
		/>
	<a href='#'  onclick='javascript:changeThreadNumber(this,1,"Read");return false;' accesskey='' >></a><br>
	</form>


</div>


<div id='chart-area-1'  style='display:block; 
	min-width: 800px; height: 400px; 
	margin: 100 auto; 
	background-color:#aaa; 
	float:left;
'>
</div>
<div id='msg-area'  style='display:block; 
	min-width: 200px; height: 600px; 
	background-color:#def; 
	overflow:hidden;
	float:left;
'>{{.SomeKey}}
</div>


	<script>

		var js_dry_run = false;

		var cntrGotPerformanceCur   = 0;
		var cntrGotPerformanceMax   = 100*100*60;		

		var timer_id_1 = 0;
		var timer_id_chart = 0;

		var jsonMap = {};												// holds current performance data
		jsonMap["K Reads per Sec"] = 0;
		jsonMap["Inserts per Sec * 10"] = 0;
		jsonMap["Tails per Sec"] = 0;
		jsonMap["Lag of Tail Cursor"] = 0;
		jsonMap["Hot Set to SysRAM"] = 0;

		var arrColors = new Array();
		arrColors[0] = "#00377B";
		arrColors[1] = "#F60";
		arrColors[2] = "#647447";
		arrColors[3] = "#EE0000";
		arrColors[4] = "#529933";
		

		function generateSeriesInitData(){
				// generate an array of random data
				var data = [],
					time = (new Date()).getTime(),
					i;
				for( i = -99; i <= 0; i++ ){
					data.push({
						x: time + i * 1000,
						//y: 0.1 * Math.random()
						y: 0
					});
				}
				return data;
			}

		
		
		// init chart series
		var seriesArray = new Array();
		var i = 0
		$.each( jsonMap, function(key, val) { 
				var loopMap = {};		
				loopMap["name"] = key

				loopMap["marker"] = {radius: 0 };
				var modu = i % arrColors.length;
				loopMap["color"] = arrColors[modu];
				loopMap["data"] = generateSeriesInitData();
				
				seriesArray[i] = loopMap;
				i++;
			}
		);
		
		

		
		
		function cmdStart(){ 
			$.ajax({
				url: '/start/someid',
				cache: false
			})		
		}
		function cmdStop(){ 
			$.ajax({
				url: '/stop/someid',
				cache: false
			})
			cmChartingStop();
		}

		function cmChartingStop(){ 
			clearInterval(timer_id_chart);			
			cntrGotPerformanceMax = 2;
			//alert('Ajax requests stopped: ' + cntrGotPerformanceMax );
		}


		function getPerformanceData(){ 
			cntrGotPerformanceCur++;
			if( cntrGotPerformanceCur >= cntrGotPerformanceMax ){
				cntrGotPerformanceCur = 'finished'
				clearInterval(timer_id_1);
				return;
			} 
			if( js_dry_run ) return;
			$.ajax({
				url: '/data/?hostname=r900&',
				cache: false
			}).done(function( argJsonMap ) {
				var keyVal = ""
				var countKeys = 0
				$.each( argJsonMap, function(key, val) { keyVal = key + ":" + val + "<br>" + keyVal ;  countKeys++});
				if( countKeys > 0 ) {
					jsonMap = argJsonMap
				}
				var prepend = '<br>Durchlauf ' + cntrGotPerformanceCur + ' Anz.' + countKeys + '<br>' + keyVal;
				$('#msg-area').prepend( prepend );

			});
		}

		jQuery(document).ready(function($) {

			getPerformanceData();
			timer_id_1   = setInterval('getPerformanceData()',1000);


		});
							
	</script>
	
	
	
	<script>
	$( function(){
		//return;
		$(document).ready(function() {
			Highcharts.setOptions({
				global: {
					useUTC: false
				}
			});
		
			var chart;
			$('#chart-area-1').highcharts({
				title: {
					text: ''
				},
				chart: {
					type: 'spline',
					animation: Highcharts.svg, // don't animate in old IE
					marginRight: 10,
					marginLeft: 210,
					events: {
						load: function(){
							var arrSeries = this.series;
							timer_id_chart = setInterval( function(){
								var x  = (new Date()).getTime(); // current time
								for( var j=0; j < arrSeries.length; j++ ){
									var lpName = arrSeries[j]["name"];
									
									var y = 0
									if( lpName in jsonMap ){
										y = jsonMap[ lpName ] ;
									}	else {
										// no current value, we need to "write forth" the most recent data point
										var prevData = arrSeries[j].data;
										if( prevData.length > 1 ){
											y = prevData[prevData.length-1]["y"]
											//$('#msg-area').prepend( "<br>pdp" + cntrGotPerformanceCur + lpName + ":"+ y  );
										} else {
											y = 0;
										}
									}
									arrSeries[j].addPoint([x, y], true, true);	
									
								}
							}, 1000);
						}
					}
				},
				xAxis: {
					type: 'datetime',
					tickPixelInterval: 150
				},
				yAxis: {
					title: {
						text: 'versch.'
					},
					plotLines: [{
						value: 0,
						width: 1,
						color: '#808080'
					}]
				},
				tooltip: {
					formatter: function() {
							return '<b>'+ this.series.name +'</b><br/>'+
							Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) +'<br/>'+
							Highcharts.numberFormat(this.y, 2);
					}
				},

 				legend: {
					layout: 'vertical',
					align: 'left',
					verticalAlign: 'top',
					x: -10,
					y: 100,
					borderWidth: 0,
					itemMarginBottom: 18
				},
				exporting: {
					enabled: false
				},
				series: seriesArray	
			});
		});
		
	});		
		
	</script>